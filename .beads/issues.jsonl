{"id":"moon_skrifa-i7z","title":"移植 skrifa-reference 到 MoonBit","description":"目标：逐步把 fontations-reference/skrifa 的核心能力移植到本仓库（MoonBit）。\n\n范围（分阶段）：\n- internal collections（SmallVec 等）\n- FontRef：SFNT/collection 校验、table 目录解析、table slice API\n- outline：glyf/cff format 探测、基础轮廓提取接口（先不做 hinting）\n- charmap/metrics/variation：按依赖逐步引入\n\n验收：\n- 新增/移植的上游测试在 MoonBit 中通过（可分批先 #skip）\n- moon check + moon test 通过\n","status":"open","priority":2,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-01-23T14:16:23.914464+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:16:23.914464+08:00"}
{"id":"moon_skrifa-i7z.1","title":"移植 skrifa/src/collections.rs（SmallVec）并移植测试","description":"从 fontations-reference/skrifa/src/collections.rs 移植 internal SmallVec：\n- Inline/Heap 两种 storage（逻辑层面即可）\n- new/with_len/clear/try_reserve/push/pop/truncate/as_view 等\n- 迁移上游 #[test] 到 MoonBit test（同名用例）\n\n验收：moon test 通过；SmallVec 行为与上游测试一致。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:16:31.970839+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:21:10.635821+08:00","closed_at":"2026-01-23T14:21:10.635821+08:00","close_reason":"ported collections SmallVec + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.1","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:16:31.971665+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.2","title":"移植 skrifa/src/decycler.rs 并移植测试","description":"从 fontations-reference/skrifa/src/decycler.rs 移植 DFS cycle detector：\n- DecyclerError（DepthLimitExceeded/CycleDetected）\n- Decycler（max_depth 参数化）\n- enter/leave + 递归用法替代 RAII guard\n- 迁移上游 3 个测试用例\n\n验收：moon test 通过；行为与上游测试一致。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:22:25.020633+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:25:06.152972+08:00","closed_at":"2026-01-23T14:25:06.152972+08:00","close_reason":"ported decycler + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.2","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:22:25.021325+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.3","title":"实现 FontRef：SFNT/TTC 校验与 table 目录解析（最小 read-fonts 子集）","description":"扩展 src/font.mbt：\n- FontRef::new / from_index 校验单字体与 TTC（ttcf）\n- 解析 offset table + table records\n- 提供按 tag 获取 table 的 BytesView? API（如 table(tag)）\n- 为 SFNT/TTC + table lookup 添加小型二进制构造测试（不依赖外部字体文件）\n\n验收：moon check + moon test 通过；基本 table lookup 行为被测试覆盖。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:27:12.495724+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:32:53.397996+08:00","closed_at":"2026-01-23T14:32:53.397996+08:00","close_reason":"validated SFNT/TTC + added table(tag) + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.3","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:27:12.496331+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.4","title":"对齐 instance/Size：ppem/unscaled/linear_scale（纯计算部分）","description":"扩展 src/instance.mbt 的 Size：\n- 表达 unscaled（类似 Option）\n- 增加 ppem() 与 linear_scale(units_per_em)\n- 添加对应单元测试（不依赖 FontRef/axis）\n\n验收：moon test 通过；与上游 instance.rs 的 Size 行为一致（线性缩放规则）。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:33:27.533321+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:34:46.713412+08:00","closed_at":"2026-01-23T14:34:46.713412+08:00","close_reason":"aligned Size ppem/unscaled/linear_scale + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.4","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:33:27.534001+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.5","title":"outline：让 OutlineGlyphCollection 绑定 FontRef 并实现 format() 探测 (glyf/CFF/CFF2)","description":"基于 FontRef::table(tag) 实现 outline 格式探测：\n- 增加 OutlineGlyphCollection::from_font(font)（保留现有 new() 兼容）\n- format()：优先 glyf；否则 CFF / CFF2；都没有则 None\n- 补充单元测试：用最小 SFNT bytes 构造含 glyf / CFF / CFF2 table 目录的字体\n\n验收：moon test 通过；format() 行为可测。\n","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:35:26.160507+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:35:26.160507+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.5","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:35:26.16119+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.6","title":"charmap：实现最小 cmap 解析（格式 4/12）与 glyph_id 查询","description":"新增/扩展 charmap 模块：\n- 基于 FontRef::table(\"cmap\") 解析 cmap header + encoding records\n- 支持 format 4（BMP）与 format 12（UCS-4）查码到 GlyphId\n- 单元测试：构造最小 cmap table bytes（不依赖外部字体文件）\n\n验收：moon test 通过；给定 codepoint 返回期望 GlyphId。\n","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:35:35.882175+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:35:35.882175+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.6","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:35:35.883047+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.7","title":"instance：移植 Location/LocationRef（基于 SmallVec）并添加 tests","description":"从 skrifa/src/instance.rs 移植：\n- LocationRef（is_default/effective_coords）\n- Location（owned coords，基于本仓库的 SmallVec）\n- 先只做纯数据结构与测试，不依赖 FontRef/axes\n\n验收：moon test 通过；is_default/effective_coords 行为与上游一致。\n","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:35:43.398177+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:35:43.398177+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.7","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:35:43.398789+08:00","created_by":"Milky2018"}]}
