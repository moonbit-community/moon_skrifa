{"id":"moon_skrifa-i7z","title":"移植 skrifa-reference 到 MoonBit","description":"目标：逐步把 fontations-reference/skrifa 的核心能力移植到本仓库（MoonBit）。\n\n范围（分阶段）：\n- internal collections（SmallVec 等）\n- FontRef：SFNT/collection 校验、table 目录解析、table slice API\n- outline：glyf/cff format 探测、基础轮廓提取接口（先不做 hinting）\n- charmap/metrics/variation：按依赖逐步引入\n\n验收：\n- 新增/移植的上游测试在 MoonBit 中通过（可分批先 #skip）\n- moon check + moon test 通过\n","status":"open","priority":2,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-01-23T14:16:23.914464+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:16:23.914464+08:00"}
{"id":"moon_skrifa-i7z.1","title":"移植 skrifa/src/collections.rs（SmallVec）并移植测试","description":"从 fontations-reference/skrifa/src/collections.rs 移植 internal SmallVec：\n- Inline/Heap 两种 storage（逻辑层面即可）\n- new/with_len/clear/try_reserve/push/pop/truncate/as_view 等\n- 迁移上游 #[test] 到 MoonBit test（同名用例）\n\n验收：moon test 通过；SmallVec 行为与上游测试一致。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:16:31.970839+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:21:10.635821+08:00","closed_at":"2026-01-23T14:21:10.635821+08:00","close_reason":"ported collections SmallVec + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.1","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:16:31.971665+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.10","title":"string：实现 name table 解析与 localized_strings/english_or_first","description":"从 skrifa/src/string.rs 移植 name table 支持：\n- StringId 枚举（至少 FAMILY_NAME/SUBFAMILY_NAME）\n- 解析 name records + storage\n- localized_strings(StringId) 迭代器 + english_or_first/find by language\n- 单元测试：合成 name table bytes（覆盖语言映射）\n\n验收：moon test 通过；localized 选择策略可测。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T15:12:24.25307+08:00","created_by":"Milky2018","updated_at":"2026-01-23T15:56:11.897519+08:00","closed_at":"2026-01-23T15:56:11.897519+08:00","close_reason":"Implemented name table parsing + LocalizedStrings (language tags v1, langId mapping) + english_or_first + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.10","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T15:12:24.253786+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.11","title":"outline：实现 glyf 轮廓提取（move/line/quad/cubic）MVP","description":"在现有 format() 探测基础上：\n- 解析 loca/glyf，支持 simple glyph contours\n- 定义 minimal pen/path API（或复用 upstream path.rs 的概念）\n- 单元测试：合成 glyf/loca/head/maxp/hhea/hmtx 的最小字体片段\n\n验收：moon test 通过；至少能提取一个简单 glyph 的 path ops。\n","status":"closed","priority":2,"issue_type":"task","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-23T15:12:32.948366+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:14:18.482093+08:00","closed_at":"2026-01-23T16:14:18.482093+08:00","close_reason":"Implemented glyf simple outline extraction: new PathElement + OutlineGlyphCollection::path, parses loca/head/maxp/glyf and emits MoveTo/LineTo/QuadTo/Close; added synthetic tests","dependencies":[{"issue_id":"moon_skrifa-i7z.11","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T15:12:32.949343+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.12","title":"string: expand language mapping + implement MacRoman decoding","description":"Follow-up to i7z.10: current langid-\u003eBCP47 mapping is minimal (only a few IDs) and Macintosh platform strings are decoded as Latin-1. Port the full Skia mapping (or a reasonable subset) and implement MacRoman byte-to-Unicode mapping for platform=1.","status":"closed","priority":3,"issue_type":"task","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-23T15:58:37.974534+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:36:16.044721+08:00","closed_at":"2026-01-23T16:36:16.044721+08:00","close_reason":"Expanded language-id to BCP-47 mapping (Skia table) and implemented MacRoman decoding for name table; added tests"}
{"id":"moon_skrifa-i7z.13","title":"outline: support composite glyf glyphs (components + transforms)","description":"Current glyf outline MVP only supports simple glyphs (numberOfContours\u003e0). Add composite glyph parsing (component flags, ARG_1_AND_2_ARE_WORDS/ARGS_ARE_XY_VALUES, scaling matrices), recursion guard, and tests with translated/scaled components.","status":"closed","priority":2,"issue_type":"task","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-23T16:14:10.650405+08:00","created_by":"Milky2018","updated_at":"2026-01-23T16:23:14.120638+08:00","closed_at":"2026-01-23T16:23:14.120638+08:00","close_reason":"Implemented composite glyf outlines (xy-translation + scale transforms) with recursion guard; added synthetic tests"}
{"id":"moon_skrifa-i7z.14","title":"outline: implement CFF/CFF2 outline extraction (charstrings -\u003e PathElement)","description":"Port skrifa-reference outline/cff and outline/cff2 minimal path extraction. Parse CFF/CFF2 tables, read charstrings for glyph, interpret Type2 charstring ops (move/line/curve), and emit PathElement list. Add synthetic tests if possible or reuse reference fonts.","status":"closed","priority":2,"issue_type":"task","assignee":"Milky2018","owner":"842376130@qq.com","created_at":"2026-01-23T16:37:48.854987+08:00","created_by":"Milky2018","updated_at":"2026-01-23T17:08:29.221383+08:00","closed_at":"2026-01-23T17:08:29.221383+08:00","close_reason":"Closed","dependencies":[{"issue_id":"moon_skrifa-i7z.14","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T17:11:06.955985+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.15","title":"glyph_name: implement GlyphNames (post/CFF)","description":"Port fontations-reference/skrifa/src/glyph_name.rs.\\n- Parse post table glyph names (at least v2.0)\\n- Optionally source names from CFF charset/strings\\n- Fallback synthesized 'gidDDD'\\n- Add tests","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T17:09:55.188315+08:00","created_by":"Milky2018","updated_at":"2026-01-23T17:09:55.188315+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.15","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T17:09:55.189135+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.16","title":"setting/tag: add Tag type and VariationSetting","description":"Port fontations-reference/skrifa/src/setting.rs and Tag plumbing needed by variation APIs.\\n- Tag parsing from 4-byte strings\\n- Setting[T]/VariationSetting\\n- Tests","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T17:09:56.641739+08:00","created_by":"Milky2018","updated_at":"2026-01-23T17:09:56.641739+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.16","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T17:09:56.642356+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.17","title":"variation: implement AxisCollection + NamedInstance","description":"Port fontations-reference/skrifa/src/variation.rs (fvar/avar) on top of existing Location/LocationRef.\\n- Minimal fvar axis reading + normalization\\n- avar remap (optional)\\n- NamedInstanceCollection\\n- Tests","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T17:09:59.303455+08:00","created_by":"Milky2018","updated_at":"2026-01-23T17:09:59.303455+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.17","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T17:09:59.304112+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.18","title":"provider: add MetadataProvider facade","description":"Port fontations-reference/skrifa/src/provider.rs.\\n- Define MetadataProvider trait-like API for FontRef\\n- Wire existing modules (attributes/metrics/charmap/string/outline)\\n- Add minimal tests","status":"open","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T17:10:16.199455+08:00","created_by":"Milky2018","updated_at":"2026-01-23T17:10:16.199455+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.18","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T17:10:16.200205+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.19","title":"bitmap: basic BitmapStrikes (sbix/CBDT/EBDT)","description":"Port fontations-reference/skrifa/src/bitmap.rs (likely incremental).\\nStart with format detection + a minimal strike lookup; defer full glyph decoding if needed.","status":"open","priority":3,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T17:10:18.243535+08:00","created_by":"Milky2018","updated_at":"2026-01-23T17:10:18.243535+08:00","dependencies":[{"issue_id":"moon_skrifa-i7z.19","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T17:10:18.244253+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.2","title":"移植 skrifa/src/decycler.rs 并移植测试","description":"从 fontations-reference/skrifa/src/decycler.rs 移植 DFS cycle detector：\n- DecyclerError（DepthLimitExceeded/CycleDetected）\n- Decycler（max_depth 参数化）\n- enter/leave + 递归用法替代 RAII guard\n- 迁移上游 3 个测试用例\n\n验收：moon test 通过；行为与上游测试一致。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:22:25.020633+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:25:06.152972+08:00","closed_at":"2026-01-23T14:25:06.152972+08:00","close_reason":"ported decycler + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.2","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:22:25.021325+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.3","title":"实现 FontRef：SFNT/TTC 校验与 table 目录解析（最小 read-fonts 子集）","description":"扩展 src/font.mbt：\n- FontRef::new / from_index 校验单字体与 TTC（ttcf）\n- 解析 offset table + table records\n- 提供按 tag 获取 table 的 BytesView? API（如 table(tag)）\n- 为 SFNT/TTC + table lookup 添加小型二进制构造测试（不依赖外部字体文件）\n\n验收：moon check + moon test 通过；基本 table lookup 行为被测试覆盖。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:27:12.495724+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:32:53.397996+08:00","closed_at":"2026-01-23T14:32:53.397996+08:00","close_reason":"validated SFNT/TTC + added table(tag) + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.3","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:27:12.496331+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.4","title":"对齐 instance/Size：ppem/unscaled/linear_scale（纯计算部分）","description":"扩展 src/instance.mbt 的 Size：\n- 表达 unscaled（类似 Option）\n- 增加 ppem() 与 linear_scale(units_per_em)\n- 添加对应单元测试（不依赖 FontRef/axis）\n\n验收：moon test 通过；与上游 instance.rs 的 Size 行为一致（线性缩放规则）。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:33:27.533321+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:34:46.713412+08:00","closed_at":"2026-01-23T14:34:46.713412+08:00","close_reason":"aligned Size ppem/unscaled/linear_scale + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.4","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:33:27.534001+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.5","title":"outline：让 OutlineGlyphCollection 绑定 FontRef 并实现 format() 探测 (glyf/CFF/CFF2)","description":"基于 FontRef::table(tag) 实现 outline 格式探测：\n- 增加 OutlineGlyphCollection::from_font(font)（保留现有 new() 兼容）\n- format()：优先 glyf；否则 CFF / CFF2；都没有则 None\n- 补充单元测试：用最小 SFNT bytes 构造含 glyf / CFF / CFF2 table 目录的字体\n\n验收：moon test 通过；format() 行为可测。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:35:26.160507+08:00","created_by":"Milky2018","updated_at":"2026-01-23T14:58:24.29057+08:00","closed_at":"2026-01-23T14:58:24.29057+08:00","close_reason":"implemented outline format detection via FontRef::table + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.5","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:35:26.16119+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.6","title":"charmap：实现最小 cmap 解析（格式 4/12）与 glyph_id 查询","description":"新增/扩展 charmap 模块：\n- 基于 FontRef::table(\"cmap\") 解析 cmap header + encoding records\n- 支持 format 4（BMP）与 format 12（UCS-4）查码到 GlyphId\n- 单元测试：构造最小 cmap table bytes（不依赖外部字体文件）\n\n验收：moon test 通过；给定 codepoint 返回期望 GlyphId。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:35:35.882175+08:00","created_by":"Milky2018","updated_at":"2026-01-23T15:07:39.146017+08:00","closed_at":"2026-01-23T15:07:39.146017+08:00","close_reason":"added minimal cmap format 4/12 parsing + synthetic SFNT tests","dependencies":[{"issue_id":"moon_skrifa-i7z.6","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:35:35.883047+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.7","title":"instance：移植 Location/LocationRef（基于 SmallVec）并添加 tests","description":"从 skrifa/src/instance.rs 移植：\n- LocationRef（is_default/effective_coords）\n- Location（owned coords，基于本仓库的 SmallVec）\n- 先只做纯数据结构与测试，不依赖 FontRef/axes\n\n验收：moon test 通过；is_default/effective_coords 行为与上游一致。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T14:35:43.398177+08:00","created_by":"Milky2018","updated_at":"2026-01-23T15:11:01.101353+08:00","closed_at":"2026-01-23T15:11:01.101353+08:00","close_reason":"ported Location/LocationRef (SmallVec-backed) + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.7","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T14:35:43.398789+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.8","title":"metrics：实现最小水平 metrics（hhea/hmtx/maxp）","description":"基于 FontRef::table(tag) 解析：\n- maxp.numGlyphs\n- hhea.numberOfHMetrics\n- hmtx advanceWidth/lsb 查询（至少 glyph_id \u003c numGlyphs）\n- 单元测试：用合成 SFNT bytes 构造最小表集合并校验查询结果\n\n验收：moon test 通过；常见边界（越界 glyph、缺表）覆盖。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T15:12:03.219583+08:00","created_by":"Milky2018","updated_at":"2026-01-23T15:21:05.731262+08:00","closed_at":"2026-01-23T15:21:05.731262+08:00","close_reason":"implemented minimal maxp/hhea/hmtx parsing + tests","dependencies":[{"issue_id":"moon_skrifa-i7z.8","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T15:12:03.220379+08:00","created_by":"Milky2018"}]}
{"id":"moon_skrifa-i7z.9","title":"attribute：实现 Stretch/Style/Weight（基于 OS/2 + head/macStyle）","description":"从 skrifa/src/attribute.rs 移植：\n- Stretch/Style/Weight 类型与常量\n- FontRef::attributes()（或 AttributesProvider）\n- 单元测试：合成 SFNT bytes 覆盖缺 OS/2、带 OS/2、italic/oblique 等\n\n验收：moon test 通过；行为与上游测试一致。\n","status":"closed","priority":2,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-23T15:12:13.951949+08:00","created_by":"Milky2018","updated_at":"2026-01-23T15:32:08.052951+08:00","closed_at":"2026-01-23T15:32:08.052951+08:00","close_reason":"ported Attributes/Stretch/Style/Weight from OS/2/head/post + synthetic tests","dependencies":[{"issue_id":"moon_skrifa-i7z.9","depends_on_id":"moon_skrifa-i7z","type":"parent-child","created_at":"2026-01-23T15:12:13.952599+08:00","created_by":"Milky2018"}]}
